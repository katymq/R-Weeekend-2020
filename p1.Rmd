---
title: "The Life & Times of a Reproducible Clinical Project in R"
author: "Jennifer L Thompson, MPH<br>
<span style = 'font-size: 50%;'>
Vanderbilt University Medical Center<br>
Department of Biostatistics + Center for Critical Illness, 
Brain Dysfunction & Survivorship</span>"
date: 'R/Medicine 2018'
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
---
class: center, inverse
<img src="kat_pre.JPEG" width="950" height="500">
---


# Datos Georeferenciados

- Datos espaciales, geográficos o geoespaciales

--

- Son las piezas básicas de información necesarias para identificar la ubicación geográfica de los fenómenos en toda la superficie de la Tierra. 

--

- Puntos referidos por la latitud y la longitud o datos de área. 

--
- Ejemplo: investigación epidemiológica

--

.center[
![Saw](https://assets.weforum.org/editor/T2LqNYMC7ySW056DYa8N-odB47WD49lgXrvfRwSBYKE.gif)


---

# Fuente:
<center>

<img src="https://www.presidencia.gob.ec/wp-content/uploads/2019/05/Captura-de-pantalla-2019-05-15-a-las-23.03.17.png" width="700" height="450">



[INEC](https://www.ecuadorencifras.gob.ec/category/cartografia-2/)


---
# Requerimientos

- R + RStudio
--

- Librerías

  - *tmap*
  
--
  - *readxl*
  
--
  - *ggplot2*
  
--

- Descargar los archivos:
  - *ec2.RData*
  
--
  - *baseMapas.xslx*
  
--
  - *base_cantones.RData*
  
--
  - *base1*
  
--

- Datos: [Github](https://github.com/katymq/R-Weeekend-2020)



---
# Cartografia Ecuador por cantones

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
library(tmap)
load("ec2.RData") #mapa de ecuador por cantones
```
--

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
tmap_mode("plot")#mode de visualización
tm_shape(ec2) +  tm_borders() + tm_layout(main.title = "Ecuador")
```



---

# ¿Qué información tenemos?

- polígonos

--

- data


```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
ec2@data[1:4, ]
```

---

# ¿Qué podemos hacer?

- Incorporar información previamente procesada

--


## *¿Es fácil incorporar nueva información a los mapas?*



--


<br>

<center>
![pregunta](https://i2.wp.com/www.koejufm.com/wp-content/uploads/2019/01/escritura-de-x-www.laguiadelvaron-1.gif?ssl=1)


---

# "Datos en el mapa"

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}

library(readxl)
base<-read_excel("baseMapas.xlsx",sheet = 2)
head(base)
```


```{r, fig.pos="center",warning=FALSE, echo=FALSE, error=FALSE, message=FALSE}
setwd("C:/Users/katyt/Desktop/Ecuador/R-Weekend")
eliminarNA<-function(v,a){
  v[is.na(v)]<-a
  return(v)
}

porcentaje<-function(v,a){
  v<-round(v/a,4)*100
  return(v)
}

```


---

# "Datos importantes"

- Indicador socioeconómico

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
load("base_cantones.RData")
head(base_cantones[1:6])
```


---

# Unir la información

- Utilizamos el identificador _"id_can"_


```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
#load("b1.RData")
base$id<-1:NROW(base)
b1<-merge.data.frame(base,base_cantones,"id_can",all.x = T)
b1<-b1[order(b1$id),]
head(b1[,1:10])
```


---

# Unir toda la información



![Next](https://static.wixstatic.com/media/50bf19_26dc7a3458e54ed49a2907385776c24a~mv2.gif)


--

- Agregar la informació (__b1__) al mapa

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
ec2@data<-b1

```
  
  
---


#  Datos + Mapas

## Caso: Pichincha


```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}

pichincha <- ec2[ec2$id_provin==17,]

```

--
 
 
```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}

head(pichincha@data[1:5])

``` 



---


#  Datos + Mapas



```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
library(tmap)
tmap_mode("plot")#mode de visualización
tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")
```


---

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
names(pichincha@data)
```

---


```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
# Variable: **Media**
tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")+ tm_fill("Media", title="Media", palette = "Blues")
```


---



```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
#Nombres de los cantones
size_nombre_cantones = 0.8
tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")+
  tm_fill("Media", title="Media", palette = "Blues")+ tm_text("Canton", size= size_nombre_cantones)
```



---

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
#Modificar el cuadro de legenda
tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")+
  tm_fill("Media", title="Media", palette = "Blues")+ tm_text("Canton", size= size_nombre_cantones)+
  tm_legend(text.size=0.5, title.size=0.6, position = c("left","bottom"), bg.color = "red",bg.alpha=.2)
```


---


```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")+
  tm_fill("Media", title="Media", palette = "Blues")+tm_text("Canton", size= size_nombre_cantones)+
  tm_legend(text.size=0.5, title.size=0.6, position = c("left","bottom"), bg.color = "red", bg.alpha=.2)+
  tm_credits("Fuente: R Weeekend ",size = 0.6)
```


---

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")+
  tm_fill("Media", title="Media", palette = "Blues", legend.hist = T)+
  tm_text("Canton", size= size_nombre_cantones)+
  tm_legend(text.size=0.5, title.size=0.6, position = c("left","bottom"), bg.color = "white",bg.alpha=.2)+
  tm_credits("Fuente: R Weeekend ",size = 0.6)
```

---

# Guardar la información

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
mapa_info_pich <- tm_shape(pichincha) +  tm_borders() + tm_layout(main.title = "Pichincha")+
  tm_fill("Media", title="Media", palette = "Blues")+ #legend.show = FALSE
  tm_text("Canton", size= size_nombre_cantones)+
  tm_legend(text.size=0.5,
              title.size=0.6,
              position = c("left","bottom"), 
              bg.color = "white", 
              bg.alpha=.2)+
  tm_credits("Fuente: R Weeekend ",size = 0.6)
  
```


---
# Guardar la información

```{r, fig.pos="center",warning=FALSE, echo=TRUE, error=FALSE, message=FALSE}
mapa_info_pich
tmap_save(mapa_info_pich, filename="C:/Users/katyt/Desktop/Ecuador/R-Weekend/ejemplo.png",
              width = 1300,height = 765,units = "px",pointsize=0.8,bg="white",dpi = 100)
```












